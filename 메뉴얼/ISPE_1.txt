# ISPE 스크래퍼 상세 매뉴얼
작성일: 2026-02-02
버전: 1.0

═══════════════════════════════════════════════════════════════════════════════
1. 개요
═══════════════════════════════════════════════════════════════════════════════

ISPE (International Society for Pharmaceutical Engineering) 스크래퍼는 제약 엔지니어링
관련 최신 정보를 자동으로 수집하는 도구입니다.

주요 수집 대상:
- 주사제 제조 공정 (Injectable Manufacturing)
- 고형제 제조 공정 (Solid Dosage Manufacturing)
- QA/품질 이슈 (Quality Assurance)
- 제조 공정 관리 (Manufacturing Process Control)

파일 위치: scrapers/ispe_scraper.py

═══════════════════════════════════════════════════════════════════════════════
2. 데이터 수집 소스 (3개)
═══════════════════════════════════════════════════════════════════════════════

2.1 ISPE News 페이지
   URL: https://ispe.org/news
   방식: HTML 스크래핑
   상태: 현재 0개 수집 (사이트 구조 확인 필요 또는 봇 차단 가능)

2.2 ISPE RSS 피드 ✅
   URL: https://ispe.org/rss.xml
   방식: XML RSS 파싱
   상태: 정상 작동 (테스트에서 3개 수집)
   설명: 가장 안정적인 소스, ISPE 이벤트 및 뉴스 제공

2.3 ISPE SmartBrief 뉴스레터
   URL: https://www2.smartbrief.com/getLast.action?mode=last&b=ispe
   방식: HTML 스크래핑
   상태: 현재 0개 수집 (구독 필요 또는 구조 변경 가능)

═══════════════════════════════════════════════════════════════════════════════
3. 키워드 필터링 시스템 (60+ 키워드)
═══════════════════════════════════════════════════════════════════════════════

3.1 주사제 제조 관련 (15개)
────────────────────────────────────────────────────────────────────────────
  제조 공정:
  - injectable (주사제)
  - parenteral (비경구)
  - aseptic (무균)
  - sterile (멸균)
  - fill-finish (충전-마감)

  포장 형태:
  - vial (바이알)
  - syringe (시린지)
  - ampoule (앰플)

  특수 공정:
  - lyophilization (동결건조)
  - freeze-drying (동결건조)

  시설/환경:
  - cleanroom (클린룸)
  - isolator (아이솔레이터)
  - RABS (제한적 접근 차단 시스템)
  - Grade A (A등급 청정실)
  - annex 1 (부속서 1, EU GMP 무균 가이드라인)

3.2 고형제 제조 관련 (12개)
────────────────────────────────────────────────────────────────────────────
  제형:
  - solid dosage (고형제)
  - tablet (정제)
  - capsule (캡슐)

  제조 공정:
  - coating (코팅)
  - granulation (과립화)
  - compression (압축)
  - blending (혼합)
  - milling (분쇄)

  원료:
  - powder (분말)
  - API (원료의약품)
  - excipient (부형제)
  - formulation (제형)

3.3 QA/품질 관련 (20개)
────────────────────────────────────────────────────────────────────────────
  품질 시스템:
  - quality assurance (품질 보증)
  - QA (품질 보증)
  - QC (품질 관리)
  - quality control (품질 관리)

  규정/표준:
  - GMP (우수 의약품 제조 기준)
  - cGMP (현행 우수 의약품 제조 기준)

  밸리데이션:
  - validation (검증)
  - qualification (적격성 평가)
  - IQ (설치 적격성)
  - OQ (운전 적격성)
  - PQ (성능 적격성)

  일탈 관리:
  - deviation (일탈)
  - CAPA (시정 및 예방 조치)
  - OOS (규격 이탈)
  - OOT (경향 이탈)
  - investigation (조사)

  컴플라이언스:
  - data integrity (데이터 무결성)
  - audit (감사)
  - inspection (실사)
  - compliance (준수)

  오염 관리:
  - contamination (오염)
  - cleaning (세척)
  - CCS (청소 검증 시스템)
  - media fill (배지 충전 시험)

3.4 제조 공정 관련 (11개)
────────────────────────────────────────────────────────────────────────────
  기본 공정:
  - manufacturing (제조)
  - process control (공정 관리)
  - batch record (배치 기록)
  - SOP (표준 작업 절차)

  시설/장비:
  - equipment (장비)
  - facility (시설)
  - production (생산)
  - scale-up (스케일업)

  혁신 기술:
  - continuous manufacturing (연속 제조)
  - automation (자동화)
  - PAT (공정 분석 기술)

3.5 한글 키워드 (6개)
────────────────────────────────────────────────────────────────────────────
  - 주사제
  - 고형제
  - 품질
  - 제조
  - 공정
  - 밸리데이션

═══════════════════════════════════════════════════════════════════════════════
4. 스크래핑 프로세스 상세
═══════════════════════════════════════════════════════════════════════════════

4.1 전체 흐름
────────────────────────────────────────────────────────────────────────────
  1단계: 날짜 기준 설정
     - 월요일: 7일 전 (주말 포함)
     - 평일: 3일 전

  2단계: 3개 소스에서 순차 수집
     → ISPE News 페이지
     → ISPE RSS 피드
     → SmartBrief 뉴스레터

  3단계: 각 기사별 필터링
     - 날짜 필터: 설정된 기간 내
     - 키워드 필터: 60+ 키워드 중 1개 이상 매칭

  4단계: 전체 콘텐츠 수집
     - RSS 데이터 우선 사용
     - 개별 페이지에서 전체 내용 추출 (가능한 경우)

4.2 ISPE News 페이지 스크래핑 (_scrape_news_page)
────────────────────────────────────────────────────────────────────────────
  URL: https://ispe.org/news

  HTML 선택자 (3가지 방법 시도):
    방법 1: <article> 태그 내 링크
    방법 2: 클래스 기반 ('news-link', 'article-link', 'post-link', 'card-link')
    방법 3: URL 패턴 매칭 ('/news/' 포함된 링크)

  제한사항:
    - 최대 20개 기사
    - 5개마다 1초 딜레이 (속도 제한)

  현재 상태: 0개 수집 (사이트 접근 제한 또는 구조 변경)

4.3 ISPE RSS 피드 스크래핑 (_scrape_rss_feed) ✅ 정상 작동
────────────────────────────────────────────────────────────────────────────
  URL: https://ispe.org/rss.xml

  XML 파싱:
    - BeautifulSoup 'xml' 파서 사용
    - <item> 태그 추출

  추출 데이터:
    - <title>: 기사 제목
    - <link>: 기사 URL
    - <pubDate>: 발행일
    - <description>: 요약 내용

  처리 순서:
    1. RSS에서 제목/링크/날짜/요약 추출
    2. 키워드 필터링 (제목 + 요약)
    3. 개별 페이지 방문하여 전체 내용 수집
    4. 403 에러 시 RSS 데이터만 사용

  성공 사례:
    - 10개 RSS 항목 발견
    - 3개 기사 수집 (키워드 매칭)
    - 매칭 키워드: validation, EM, IQ, OOT, HVAC, security, accuracy

4.4 SmartBrief 뉴스레터 스크래핑 (_scrape_smartbrief)
────────────────────────────────────────────────────────────────────────────
  URL: https://www2.smartbrief.com/getLast.action?mode=last&b=ispe

  HTML 선택자 (2가지 방법 시도):
    방법 1: 클래스 기반 ('story', 'item', 'news-item', 'article-item')
    방법 2: 뉴스레터 콘텐츠 영역 내 모든 링크

  추출 요소:
    - 제목: <h1~h4>, <strong>, <b> 태그
    - 요약: 'description', 'summary', 'excerpt' 클래스
    - 날짜: 'date', 'publish-date' 클래스 (없으면 현재 날짜 사용)

  제한사항:
    - 최대 30개 항목
    - http로 시작하는 링크만

  현재 상태: 0개 수집 (구독 필요 또는 HTML 구조 변경)

4.5 개별 기사 파싱 (_parse_article)
────────────────────────────────────────────────────────────────────────────
  RSS 데이터 우선 사용 전략:
    - 제목/날짜/요약이 RSS에 있으면 사용
    - 전체 내용이 부족하면 페이지 방문

  페이지 콘텐츠 추출 (HTML 선택자):
    제목: h1, h1.article-title, h1.entry-title, .page-title
    날짜: time[datetime], .publish-date, .article-date, meta[property="article:published_time"]
    본문: article, .article-body, .entry-content, .post-content, main

  정리 작업:
    - script, style, nav, footer, header, aside 태그 제거
    - 최대 1000자 저장 (full_text)
    - 최대 300자 요약 (summary)

  403 에러 처리:
    - RSS 데이터만 사용하고 계속 진행

═══════════════════════════════════════════════════════════════════════════════
5. 봇 차단 방지 기술
═══════════════════════════════════════════════════════════════════════════════

5.1 HTTP 헤더 (get_headers)
────────────────────────────────────────────────────────────────────────────
  User-Agent: Chrome 131.0.0.0 (최신 브라우저 시뮬레이션)
  Accept: HTML, XHTML, XML 등 모든 형식
  Accept-Language: en-US, en, ko
  Accept-Encoding: gzip, deflate (br 제외 - brotli 미지원)
  Connection: keep-alive
  Upgrade-Insecure-Requests: 1
  Sec-Fetch-Dest: document
  Sec-Fetch-Mode: navigate
  Sec-Fetch-Site: none
  Sec-Fetch-User: ?1
  Cache-Control: max-age=0
  Referer: https://www.google.com/

5.2 요청 속도 제한
────────────────────────────────────────────────────────────────────────────
  - RSS 피드: 2초 딜레이
  - News 페이지: 3초 딜레이
  - SmartBrief: 3초 딜레이
  - 개별 기사: 1초 딜레이
  - News 페이지 5개마다: 추가 1초 딜레이

5.3 세션 관리
────────────────────────────────────────────────────────────────────────────
  - requests.Session() 사용
  - 쿠키 자동 유지
  - 동일 서버 연결 재사용

═══════════════════════════════════════════════════════════════════════════════
6. 데이터 분류 및 태깅
═══════════════════════════════════════════════════════════════════════════════

6.1 자동 분류
────────────────────────────────────────────────────────────────────────────
  기본 모듈: src/keywords.py의 classify_article() 함수 사용

  ISPE 특화 처리:
    - 기본 분류가 없으면: ["ISPE", "제약엔지니어링"]
    - 추가로 60+ 타겟 키워드 스캔
    - 매칭된 키워드 최대 10개까지 저장

6.2 출력 형식 (NewsArticle)
────────────────────────────────────────────────────────────────────────────
  title: "[ISPE] " + 원본 제목 (또는 "[ISPE SmartBrief] " + 제목)
  link: 원본 기사 URL
  published: 발행일 (datetime 객체)
  source: "ISPE"
  summary: 요약 (최대 300자)
  full_text: 전체 내용 (최대 1000자)
  images: [] (이미지 없음)
  scrape_status: "success"
  classifications: 분류 목록
  matched_keywords: 매칭된 키워드 목록 (최대 10개)

═══════════════════════════════════════════════════════════════════════════════
7. 파이프라인 통합
═══════════════════════════════════════════════════════════════════════════════

7.1 자동 실행 시스템
────────────────────────────────────────────────────────────────────────────
  위치: src/multi_source_scraper.py (124-129줄)

  설정:
    "ispe": {
        "class": ISPEScraper,
        "enabled": True,
        "description": "ISPE (주사제/고형제 제조 공정, QA 이슈)",
        "args": {}
    }

7.2 실행 스케줄
────────────────────────────────────────────────────────────────────────────
  시간: 매일 오전 7시
  실행 파일: src/run_pipeline.py

  프로세스:
    1단계: 뉴스 스크래핑 (multi_source_scraper.py)
           └─ ISPE 스크래퍼 실행
    2단계: AI 요약 생성 (ai_summarizer_gemini.py)
    3단계: 이메일 발송 (email_sender.py)

7.3 데이터 저장
────────────────────────────────────────────────────────────────────────────
  원본 데이터: data/news/multi_source_news_YYYYMMDD.json
  AI 요약: data/news/multi_source_summarized_YYYYMMDD.json
  보관 기간: 14일 (자동 삭제)

═══════════════════════════════════════════════════════════════════════════════
8. 테스트 결과 (2026-02-02)
═══════════════════════════════════════════════════════════════════════════════

테스트 조건: 30일 lookback
명령어: python scrapers/ispe_scraper.py --days 30

8.1 ISPE News 페이지
────────────────────────────────────────────────────────────────────────────
  결과: 0개 수집
  이유: HTML 구조 불일치 또는 봇 차단
  조치: RSS 피드가 정상 작동하므로 현재 문제 없음

8.2 ISPE RSS 피드 ✅
────────────────────────────────────────────────────────────────────────────
  결과: 3개 수집 성공

  발견된 RSS 항목: 10개
  키워드 매칭: 3개

  수집된 기사 예시:
    1. ISPE GAMP UK - Coffee Break Talk: Using Critical Thinking for your Validation Strategy
       키워드: update, EM, validation
       URL: https://ispe.org/uk-affiliate/events/ispe-gamp-uk-coffee-break-talk-using-critical-thinking-your-validation-strategy

    2. ISPE UK Southern Committee - Concorde Experience
       키워드: EM, IQ
       URL: https://ispe.org/uk-affiliate/events/ispe-uk-southern-committee-concorde-experience

    3. Sustainable Pharma: Innovating for a Greener Future
       키워드: HVAC, EM, OOT, security, accuracy
       URL: https://ispe.org/uk-affiliate/events/sustainable-pharma-innovating-greener-future

8.3 SmartBrief 뉴스레터
────────────────────────────────────────────────────────────────────────────
  결과: 0개 수집
  이유: 구독 필요 또는 HTML 구조 변경
  조치: 추후 조사 필요

8.4 인코딩 에러
────────────────────────────────────────────────────────────────────────────
  문제: 'cp949' codec can't encode character '\u2713' (✓, –)
  영향: 콘솔 출력만 영향, 데이터 수집은 정상
  원인: Windows 콘솔 인코딩 (cp949)
  해결: 데이터 수집에는 문제 없으므로 무시 가능

═══════════════════════════════════════════════════════════════════════════════
9. 문제 해결 가이드
═══════════════════════════════════════════════════════════════════════════════

9.1 수집 결과가 0개일 때
────────────────────────────────────────────────────────────────────────────
  1. RSS 피드 확인:
     - 브라우저에서 https://ispe.org/rss.xml 접속
     - XML 데이터가 보이는지 확인

  2. 키워드 필터 확인:
     - TARGET_KEYWORDS에 관련 키워드 추가
     - _matches_keywords() 함수 로직 확인

  3. 날짜 필터 확인:
     - days_back 값 증가 (예: 30, 60일)
     - RSS 항목의 pubDate 형식 확인

9.2 403 Forbidden 에러
────────────────────────────────────────────────────────────────────────────
  현재 대응:
    - RSS 데이터만 사용하고 계속 진행
    - 에러 메시지 출력하지만 프로그램 중단 안 함

  추가 대응 방안:
    - User-Agent 변경
    - 딜레이 시간 증가
    - VPN 사용 고려

9.3 인코딩 에러 (cp949)
────────────────────────────────────────────────────────────────────────────
  임시 해결책:
    - 환경 변수 설정: set PYTHONIOENCODING=utf-8
    - 실행 시: chcp 65001 (Windows 코드 페이지 변경)

  영구 해결책:
    - print() 문에 errors='ignore' 추가
    - 또는 파일 출력으로 변경

═══════════════════════════════════════════════════════════════════════════════
10. 향후 개선 사항
═══════════════════════════════════════════════════════════════════════════════

10.1 우선순위 높음
────────────────────────────────────────────────────────────────────────────
  □ ISPE News 페이지 스크래핑 복구
    → HTML 구조 재분석
    → 필요 시 selenium 사용 (JavaScript 렌더링)

  □ SmartBrief 뉴스레터 조사
    → 구독 필요 여부 확인
    → 대체 접근 방법 검토

10.2 우선순위 중간
────────────────────────────────────────────────────────────────────────────
  □ 콘솔 인코딩 에러 해결
    → UTF-8 강제 또는 에러 무시

  □ 키워드 확장
    → 실제 수집 데이터 분석
    → 놓친 중요 키워드 추가

  □ 성능 최적화
    → 병렬 처리 고려
    → 캐싱 메커니즘 추가

10.3 우선순위 낮음
────────────────────────────────────────────────────────────────────────────
  □ 이미지 수집 기능
  □ PDF 파일 자동 다운로드
  □ 히스토리 데이터베이스 구축

═══════════════════════════════════════════════════════════════════════════════
11. 관련 파일 및 의존성
═══════════════════════════════════════════════════════════════════════════════

11.1 주요 파일
────────────────────────────────────────────────────────────────────────────
  scrapers/ispe_scraper.py          - 메인 스크래퍼
  scrapers/base_scraper.py          - 베이스 클래스
  src/keywords.py                   - 키워드 분류
  src/multi_source_scraper.py       - 통합 스크래퍼
  src/run_pipeline.py               - 파이프라인 실행
  src/ai_summarizer_gemini.py       - AI 요약
  src/email_sender.py               - 이메일 발송

11.2 Python 패키지
────────────────────────────────────────────────────────────────────────────
  requests                          - HTTP 요청
  beautifulsoup4                    - HTML/XML 파싱
  lxml                              - XML 파서 (BeautifulSoup 백엔드)
  python-dateutil                   - 날짜 파싱

11.3 환경 변수
────────────────────────────────────────────────────────────────────────────
  config/.env 파일:
    GEMINI_API_KEY                  - Gemini AI API 키
    SMTP_*                          - 이메일 설정

═══════════════════════════════════════════════════════════════════════════════
12. 연락처 및 지원
═══════════════════════════════════════════════════════════════════════════════

프로젝트: 제약 뉴스 에이전트
작성자: Claude Sonnet 4.5
최종 업데이트: 2026-02-02

═══════════════════════════════════════════════════════════════════════════════
문서 끝
═══════════════════════════════════════════════════════════════════════════════
